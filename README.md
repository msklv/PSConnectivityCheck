# PSConnectivityCheck

## Описание

Инструмент проверки сетевой связанности элементов контура на уровне портов и протоколов. Позволяет выявлять проблемы с подключением и конфигурацией сетевых устройств, а также генерировать отчеты о готовности окружения к работе.

## Проверки

- Доступность удаленного порта
- Корректность работы HTTP и HTTPS
- Работа DNS

## Алгоритм работы

- Поиск тестов по Имени хоста или Алиасам
  - Если нет совпадений, то берем из `_default_` секции
- Разрешение DNS имен в Тестах
- Выполнение проверок в сл. порядке:
  - PORT - Открытость порта, любой протокол
  - HTTP - Проверка протокола HTTP и кода ответа из диапазона 2xx или 3xx
- Формирование отчета в формате Markdown  

## Требования к среде исполнения

- PowerShell 6, лучше 7 и выше
- OS
  - AltLinux p8, лучше p10 и выше
  - AstraLinux 1.7 и выше
  - MacOS 10.15 и выше
  - Windows 2012 R2 и выше
- Powershell Module `powershell-yaml`. [Описание](yaml/readme.md)

## Архитектура

![architecture](architecture.png)
[architecture](architecture.excalidraw)

## Структура проекта

```powershell
.
├── yaml                        # папка с yaml модулями
├── architecture.excalidraw     # схема архитектуры
├── PSConnectivityCheck.ps1     # основной скрипт
├── EnvironmentConnectivityExample.yaml  # пример конфигурации окружения
├── ReportExample.yaml          # пример отчета
```

## Использование

```powershell
# Запуск скрипта с указанием файла конфигурации окружения
.\PSConnectivityCheck.ps1 -EnvironmentConfigFilePath .\EnvironmentConnectivityExample.yaml
# Если не указать путь к файлу конфигурации, 
#   то будет использован файл по умолчанию - EnvironmentConnectivity.yaml
```

## Формат конфигурации окружения

```yaml
---
HostBusinessName1:        # Основное имя хоста
  alias:                  # Не обязательный параметр, альтернативные имена хоста
    - Name1.domain.ru     # Альтернативное DNS имя
    - AltName1            # Альтернативное DNS имя
  services:               # Обязательный параметр вместе с одним из протоколов
    port:
      - 10.0.0.4:         # Можно указывать несколько портов для проверки
          - 111
          - 444
      - hostName2: 222   
    http:
      - 10.0.0.3: 80
      - hostName3: 8080
    https:
      - github.com: 443

```

## Что можно улучшить

- HTTPS - Проверка протокола HTTPS, валидация сертификата и кода ответа из диапазона 2xx или 3xx
- Добавить поддержку других протоколов( S3, PostgreSQL, gRPC и т.д. )
- Загрузка файла конфигурации по http/https
- Поддержка других форматов отчетов ( HTML, JSON и т.д. )
- В `HostBusinessName1` можно использовать Regex выражения
- Запись респонса в файл для анализа позже
